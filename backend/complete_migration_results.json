{
  "start_time": "2025-12-16T10:17:24.647875",
  "environment_check": {
    "success": true
  },
  "steps": {
    "initial_analysis": {
      "success": false,
      "stdout": "\ud83d\ude80 Supabase Schema Verification Tool\n==================================================\n\ud83d\udd0d Starting comprehensive schema analysis...\n\ud83d\udd17 Testing Supabase connection...\n\u2705 Supabase connection successful\n\n\ud83d\udd0d Checking required tables...\n\u2705 Table 'conversations' exists\n\u2705 Table 'messages' exists\n\u2705 Table 'leads' exists\n\u2705 Table 'workflow_executions' exists\n\u274c Table 'agent_messages' does not exist\n\u274c Table 'shared_memory' does not exist\n\n\ud83d\udcca Analyzing table: conversations\n\n\ud83d\udcca Analyzing table: messages\n\n\ud83d\udcca Analyzing table: leads\n\n\ud83d\udcca Analyzing table: workflow_executions\n\n==================================================\n\ud83d\udccb VERIFICATION RESULTS\n==================================================\n\u2705 Connection successful to: https://ozqpzwwpgyzlxhtekywj.supabase.co\n\n\ud83d\udcca Table Status Summary:\n  conversations        \u2705 EXISTS\n  messages             \u2705 EXISTS\n  leads                \u2705 EXISTS\n  workflow_executions  \u2705 EXISTS\n  agent_messages       \u274c MISSING\n  shared_memory        \u274c MISSING\n",
      "stderr": "Traceback (most recent call last):\n  File \"/Users/test/Desktop/agentsflowai/backend/verify_current_schema.py\", line 282, in <module>\n    asyncio.run(main())\n    ~~~~~~~~~~~^^^^^^^^\n  File \"/usr/local/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/runners.py\", line 204, in run\n    return runner.run(main)\n           ~~~~~~~~~~^^^^^^\n  File \"/usr/local/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/runners.py\", line 127, in run\n    return self._loop.run_until_complete(task)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"/usr/local/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/base_events.py\", line 719, in run_until_complete\n    return future.result()\n           ~~~~~~~~~~~~~^^\n  File \"/Users/test/Desktop/agentsflowai/backend/verify_current_schema.py\", line 269, in main\n    with open(output_file, 'w') as f:\n         ~~~~^^^^^^^^^^^^^^^^^^\nFileNotFoundError: [Errno 2] No such file or directory: 'backend/schema_analysis_results.json'\n",
      "return_code": 1
    },
    "migration_apply": {
      "success": true,
      "stdout": "\ud83d\ude80 Supabase Migration Executor\n==================================================\n\ud83c\udfaf Target migration file: backend/consolidated_migration.sql\n\ud83d\udcd6 Reading migration file: backend/consolidated_migration.sql\n\u274c Migration failed!\nError details: Migration file not found: backend/consolidated_migration.sql\n",
      "stderr": "",
      "return_code": 0
    },
    "verification": {
      "success": false,
      "stdout": "\ud83d\udd0d Supabase Schema Verification Tool\nComprehensive validation after migration\n============================================================\n\ud83d\ude80 Starting comprehensive schema verification\n============================================================\n\ud83d\udd17 Testing Supabase connection...\n\u2705 Connection successful\n\n\ud83d\udccb Verifying table existence...\n  \u2705 conversations\n  \u2705 messages\n  \u2705 leads\n  \u2705 workflow_executions\n  \u274c agent_messages (HTTP 404)\n  \u274c shared_memory (HTTP 404)\n\n\ud83d\udd0d Verifying table structures...\n  Checking conversations...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking messages...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking leads...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking workflow_executions...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking agent_messages...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking shared_memory...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n\n\ud83d\uddc2\ufe0f  Verifying indexes...\n  Checking conversations...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking leads...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking workflow_executions...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n\n\ud83d\udd12 Verifying RLS policies...\n  Checking conversations...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking messages...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking leads...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking workflow_executions...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking agent_messages...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n  Checking shared_memory...\n    \u274c Error: HTTP 404: {\"code\":\"PGRST202\",\"details\":\"Searched for the function public.exec_sql with parameter query or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.\",\"hint\":null,\"message\":\"Could not find the function public.exec_sql(query) in the schema cache\"}\n\n\ud83d\udd17 Verifying foreign key constraints...\n\n\ud83d\udd27 Verifying PostgreSQL extensions...\n\n============================================================\n\ud83d\udcca VERIFICATION SUMMARY\n============================================================\n\ud83c\udfaf Overall Status: \u274c FAILED\n\ud83d\udccb All Tables Exist: \u274c\n\ud83c\udfd7\ufe0f  All Structures Valid: \u274c\n\n\ud83d\udcca Detailed Results:\n  Tables: 6 checked\n  Structures: 6 validated\n  Indexes: 3 verified\n  Policies: 6 checked\n  Foreign Keys: 0 found\n  Extensions: \u274c\n",
      "stderr": "Traceback (most recent call last):\n  File \"/Users/test/Desktop/agentsflowai/backend/comprehensive_schema_verification.py\", line 471, in <module>\n    asyncio.run(main())\n    ~~~~~~~~~~~^^^^^^^^\n  File \"/usr/local/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/runners.py\", line 204, in run\n    return runner.run(main)\n           ~~~~~~~~~~^^^^^^\n  File \"/usr/local/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/runners.py\", line 127, in run\n    return self._loop.run_until_complete(task)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"/usr/local/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/base_events.py\", line 719, in run_until_complete\n    return future.result()\n           ~~~~~~~~~~~~~^^\n  File \"/Users/test/Desktop/agentsflowai/backend/comprehensive_schema_verification.py\", line 452, in main\n    with open(output_file, \"w\") as f:\n         ~~~~^^^^^^^^^^^^^^^^^^\nFileNotFoundError: [Errno 2] No such file or directory: 'backend/schema_verification_results.json'\n",
      "return_code": 1
    }
  },
  "overall_success": false,
  "final_status": "Migration failed",
  "end_time": "2025-12-16T10:17:41.369728",
  "duration_seconds": 16.721853
}